package AceCouch::Object;

use common::sense;

use overload (
    '""'       => 'as_string',
    'fallback' => 'TRUE',
);

BEGIN { *as_string = \&name; }

sub AUTOLOAD {
    our $AUTOLOAD;
    my ($tag) = $AUTOLOAD =~ /.*::(.+)/;
    my $self = shift;

    my ($fill, $tree); # both cannot be true...

    if (defined $_[0]) {
        given($_[0]) {
            when('-fill') { $fill = 1 }
            # when(0)       { $tree = 1 } # not yet supported
            default       { AC::E::Unimplemented->throw(
                "Autogenerated accessors do not (yet?) support $_"
            ) }
        }
    }

    return $self->db->fetch(
        class  => $self->class,
        name   => $self->name,
        tag    => $tag,
        filled => $fill,
        tree   => $tree,
    );
}

sub new {
    my ($class, $args) = @_;
    return bless $args, $class;
}

sub DESTROY {}

sub id     { shift->{id} }
sub name   { shift->{data}{name} }
sub class  { shift->{data}{class} }
sub data   { shift->{data} }
sub filled { shift->{filled} }
sub db     { shift->{db} }

1;
